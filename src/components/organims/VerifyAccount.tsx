import { RootState } from "@/redux/store";
import clsx from "clsx";
import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import { Client } from "@stomp/stompjs";
import { Button, Card } from "antd";
import { useNavigate } from "react-router-dom";
import { ThunkDispatch } from "@reduxjs/toolkit";
import { setVerify } from "@/redux/features/verify";

const VerifyActived = () => {
	const [count, setCount] = useState(8);
	const navigator = useNavigate();
	useEffect(() => {
		const time = setInterval(() => {
			if (count > 0) {
				setCount((e) => e - 1);
			} else {
				clearInterval(time);
				navigator("/login");
			}
		}, 1000);
		return () => {
			clearInterval(time);
		};
	});
	return (
		<Card>
			<div className='flex items-center justify-center flex-col'>
				<svg
					width={100}
					height={100}
					viewBox='0 0 222 263'
					fill='none'
					xmlns='http://www.w3.org/2000/svg'>
					<path
						fillRule='evenodd'
						clipRule='evenodd'
						d='M221.014 30.6571C221.014 14.2604 207.72 0.966309 191.323 0.966309C177.494 0.966309 165.905 10.4352 162.605 23.2344H119.57C110.02 23.2344 102.251 31.0035 102.251 40.554V102.41H70.0855C63.1478 102.41 57.7144 107.843 57.7144 114.781V164.266C57.7144 171.087 63.2641 176.637 70.0855 176.637H102.251V189.008C102.251 198.556 110.02 206.328 119.57 206.328H183.9C193.448 206.328 201.22 198.556 201.22 189.008V58.6234C212.745 54.5434 221.014 43.58 221.014 30.6571ZM70.0855 107.358H124C125.622 107.358 125.958 111.945 125.773 117.737C124.977 118.923 124.519 120.369 124.519 121.956C124.519 123.214 124.807 124.384 125.323 125.405C125.076 128.549 124.777 131.64 124.526 134.237C124.23 137.307 124 139.689 124 140.659L62.6628 139.523V114.781C62.6628 110.55 65.8546 107.358 70.0855 107.358ZM62.6628 164.266V159.317H156.684V164.266C156.684 168.358 153.353 171.688 149.261 171.688H70.0855C65.9931 171.688 62.6628 168.358 62.6628 164.266ZM196.271 189.008C196.271 195.829 190.722 201.379 183.9 201.379H119.57C112.749 201.379 107.199 195.829 107.199 189.008V176.637H149.261C156.082 176.637 161.632 171.087 161.632 164.266V131.5C161.632 124.679 150.321 107.358 143.5 107.358L107.199 102.41V40.554C107.199 33.7326 112.749 28.1829 119.57 28.1829H161.756C161.689 29.0018 161.632 29.8208 161.632 30.6571C161.632 47.0539 174.926 60.3479 191.323 60.3479C193.013 60.3479 194.658 60.1747 196.271 59.9025V189.008ZM204.164 25.0258L188.577 39.8712C187.617 40.7841 186.107 40.7817 185.155 39.8613L178.474 33.4283C177.49 32.4806 177.46 30.9144 178.407 29.9297C179.355 28.9449 180.921 28.9153 181.906 29.8629L186.879 34.653L200.752 21.4406C201.742 20.4979 203.308 20.5375 204.251 21.5247C205.191 22.5169 205.154 24.0831 204.164 25.0258ZM156.684 38.0798H146.787C145.419 38.0798 144.313 39.1882 144.313 40.554C144.313 41.9198 145.419 43.0283 146.787 43.0283H156.684C158.052 43.0283 159.158 41.9198 159.158 40.554C159.158 39.1882 158.052 38.0798 156.684 38.0798Z'
						fill='#046C34'
					/>
					<path
						d='M185.029 257.281H152.304V240.106L165.684 228.954C166.732 228.079 166.875 226.52 166.012 225.464C165.141 224.406 163.593 224.262 162.547 225.134L152.304 233.672V207.714C152.304 206.344 151.204 205.236 149.843 205.236C148.483 205.236 147.383 206.344 147.383 207.714V216.849L137.066 206.458C136.104 205.489 134.549 205.489 133.587 206.458C132.625 207.427 132.625 208.993 133.587 209.962L147.383 223.858V257.281H133.766C132.917 247.006 124.623 239.189 114.166 239.189C111.934 239.189 109.675 239.663 107.522 240.466V180.452H156.979C158.34 180.452 159.439 179.344 159.439 177.974V133.363C159.439 115.599 145.09 101.145 127.453 101.145H114.658V91.5635L139.822 79.5955C140.683 79.1866 141.232 78.3117 141.232 77.3551C141.232 76.3984 140.68 75.5236 139.822 75.1146L113.248 62.475C112.483 62.1132 111.592 62.1677 110.881 62.6237C110.17 63.0748 109.737 63.8629 109.737 64.713V66.9435V89.9922V101.145H53.3908C35.7537 101.145 21.4039 115.599 21.4039 133.363V176.866L12.8733 184.554C8.83558 188.2 7.47491 193.838 9.40642 198.921C11.3502 204.039 15.949 207.218 21.4039 207.218H31.4921C46.8212 207.218 60.081 201.826 73.2571 190.214L80.4566 183.595V230.366C77.0266 228.681 73.2718 227.791 69.3842 227.791C55.4109 227.791 44.0408 239.241 44.0408 253.318C44.0408 254.669 44.2007 255.995 44.432 257.286H33.2145V233.99C33.2145 232.619 32.1122 231.511 30.7539 231.511C29.3957 231.511 28.2934 232.619 28.2934 233.99V244.168L19.5069 237.018C18.4513 236.158 16.8987 236.327 16.0474 237.39C15.1936 238.453 15.3584 240.015 16.414 240.875L28.2934 250.54V257.281H2.95C1.59179 257.281 0.489471 258.389 0.489471 259.76C0.489471 261.13 1.59179 262.238 2.95 262.238H82.9171H105.062H185.029C186.39 262.238 187.489 261.13 187.489 259.76C187.489 258.389 186.39 257.281 185.029 257.281ZM114.166 244.146C121.86 244.146 127.996 249.792 128.826 257.281H107.522V245.861C109.606 244.771 111.912 244.146 114.166 244.146ZM109.737 106.102V118.245C109.737 119.614 110.837 120.724 112.197 120.724C113.558 120.724 114.658 119.614 114.658 118.245V106.102H127.453C142.376 106.102 154.518 118.332 154.518 133.363L156.979 171.5H107.522L85.3776 175.495V133.363C85.3776 121.879 79.3641 111.807 70.361 106.102H109.737ZM69.9772 186.517C57.7902 197.258 45.5614 202.262 31.4921 202.262H21.4039C17.3785 202.262 14.9401 199.622 14.0027 197.151C13.0505 194.646 13.1169 190.993 16.1556 188.247L24.8044 180.452H76.5739L69.9772 186.517ZM48.9618 253.316C48.9618 241.975 58.1224 232.746 69.3842 232.746C73.3604 232.746 77.1472 233.938 80.4566 236.099V257.281H49.4466C49.1685 255.958 48.9618 254.612 48.9618 253.316ZM85.3776 257.281V180.452H102.601V257.281H85.3776Z'
						fill='#046C34'
					/>
				</svg>

				<h2 className='font-semibold text-base text-emerald-700 mt-3'>
					Email verified, go to login in <span className='animate-pulse'>{count}</span>s.
				</h2>
				<Button className='mt-3' href='/login'>
					Go to login
				</Button>
			</div>
		</Card>
	);
};
const VerifyAccount = ({ email }: { email: string }) => {
	// eslint-disable-next-line @typescript-eslint/no-explicit-any
	const dispatch = useDispatch<ThunkDispatch<RootState, never, any>>();

	useEffect(() => {
		const client = new Client({
			brokerURL: "wss://isphoto.ftisu.vn/ws",
			onConnect: () => {
				client.subscribe(`/api/auth/respone_verification/${email}`, (message) => {
					console.log(`Received: ${message.body}`);
					dispatch(setVerify("completed"));
				});
			},
		});
		client.activate();
	}, [dispatch, email]);
	const verify = useSelector((state: RootState) => state.verify.status);
	const onClose = () => {
		dispatch(setVerify("close"));
	};
	if (verify === "close") return <></>;

	return (
		<div
			className={clsx(
				"w-screen fixed z-[9999] left-0 top-0 items-center justify-center h-screen !h-[100dvh] flex flex-col bg-gray-600/20 transition-all ease-linear duration-300 opacity-1",
				{
					"!opacity-0": !verify,
					hidden: !verify,
				}
			)}>
			{verify === "start" && (
				<Card>
					<div className='flex items-center justify-center flex-col'>
						<svg
							width={100}
							height={100}
							viewBox='0 0 222 263'
							fill='none'
							className='animate-pulse'
							xmlns='http://www.w3.org/2000/svg'>
							<path
								fillRule='evenodd'
								clipRule='evenodd'
								d='M221.014 30.6571C221.014 14.2604 207.72 0.966309 191.323 0.966309C177.494 0.966309 165.905 10.4352 162.605 23.2344H119.57C110.02 23.2344 102.251 31.0035 102.251 40.554V102.41H70.0855C63.1478 102.41 57.7144 107.843 57.7144 114.781V164.266C57.7144 171.087 63.2641 176.637 70.0855 176.637H102.251V189.008C102.251 198.556 110.02 206.328 119.57 206.328H183.9C193.448 206.328 201.22 198.556 201.22 189.008V58.6234C212.745 54.5434 221.014 43.58 221.014 30.6571ZM70.0855 107.358H124C125.622 107.358 125.958 111.945 125.773 117.737C124.977 118.923 124.519 120.369 124.519 121.956C124.519 123.214 124.807 124.384 125.323 125.405C125.076 128.549 124.777 131.64 124.526 134.237C124.23 137.307 124 139.689 124 140.659L62.6628 139.523V114.781C62.6628 110.55 65.8546 107.358 70.0855 107.358ZM62.6628 164.266V159.317H156.684V164.266C156.684 168.358 153.353 171.688 149.261 171.688H70.0855C65.9931 171.688 62.6628 168.358 62.6628 164.266ZM196.271 189.008C196.271 195.829 190.722 201.379 183.9 201.379H119.57C112.749 201.379 107.199 195.829 107.199 189.008V176.637H149.261C156.082 176.637 161.632 171.087 161.632 164.266V131.5C161.632 124.679 150.321 107.358 143.5 107.358L107.199 102.41V40.554C107.199 33.7326 112.749 28.1829 119.57 28.1829H161.756C161.689 29.0018 161.632 29.8208 161.632 30.6571C161.632 47.0539 174.926 60.3479 191.323 60.3479C193.013 60.3479 194.658 60.1747 196.271 59.9025V189.008ZM204.164 25.0258L188.577 39.8712C187.617 40.7841 186.107 40.7817 185.155 39.8613L178.474 33.4283C177.49 32.4806 177.46 30.9144 178.407 29.9297C179.355 28.9449 180.921 28.9153 181.906 29.8629L186.879 34.653L200.752 21.4406C201.742 20.4979 203.308 20.5375 204.251 21.5247C205.191 22.5169 205.154 24.0831 204.164 25.0258ZM156.684 38.0798H146.787C145.419 38.0798 144.313 39.1882 144.313 40.554C144.313 41.9198 145.419 43.0283 146.787 43.0283H156.684C158.052 43.0283 159.158 41.9198 159.158 40.554C159.158 39.1882 158.052 38.0798 156.684 38.0798Z'
								fill='#151515'
							/>
							<path
								d='M185.029 257.281H152.304V240.106L165.684 228.954C166.732 228.079 166.875 226.52 166.012 225.464C165.141 224.406 163.593 224.262 162.547 225.134L152.304 233.672V207.714C152.304 206.344 151.204 205.236 149.843 205.236C148.483 205.236 147.383 206.344 147.383 207.714V216.849L137.066 206.458C136.104 205.489 134.549 205.489 133.587 206.458C132.625 207.427 132.625 208.993 133.587 209.962L147.383 223.858V257.281H133.766C132.917 247.006 124.623 239.189 114.166 239.189C111.934 239.189 109.675 239.663 107.522 240.466V180.452H156.979C158.34 180.452 159.439 179.344 159.439 177.974V133.363C159.439 115.599 145.09 101.145 127.453 101.145H114.658V91.5635L139.822 79.5955C140.683 79.1866 141.232 78.3117 141.232 77.3551C141.232 76.3984 140.68 75.5236 139.822 75.1146L113.248 62.475C112.483 62.1132 111.592 62.1677 110.881 62.6237C110.17 63.0748 109.737 63.8629 109.737 64.713V66.9435V89.9922V101.145H53.3908C35.7537 101.145 21.4039 115.599 21.4039 133.363V176.866L12.8733 184.554C8.83558 188.2 7.47491 193.838 9.40642 198.921C11.3502 204.039 15.949 207.218 21.4039 207.218H31.4921C46.8212 207.218 60.081 201.826 73.2571 190.214L80.4566 183.595V230.366C77.0266 228.681 73.2718 227.791 69.3842 227.791C55.4109 227.791 44.0408 239.241 44.0408 253.318C44.0408 254.669 44.2007 255.995 44.432 257.286H33.2145V233.99C33.2145 232.619 32.1122 231.511 30.7539 231.511C29.3957 231.511 28.2934 232.619 28.2934 233.99V244.168L19.5069 237.018C18.4513 236.158 16.8987 236.327 16.0474 237.39C15.1936 238.453 15.3584 240.015 16.414 240.875L28.2934 250.54V257.281H2.95C1.59179 257.281 0.489471 258.389 0.489471 259.76C0.489471 261.13 1.59179 262.238 2.95 262.238H82.9171H105.062H185.029C186.39 262.238 187.489 261.13 187.489 259.76C187.489 258.389 186.39 257.281 185.029 257.281ZM114.166 244.146C121.86 244.146 127.996 249.792 128.826 257.281H107.522V245.861C109.606 244.771 111.912 244.146 114.166 244.146ZM109.737 106.102V118.245C109.737 119.614 110.837 120.724 112.197 120.724C113.558 120.724 114.658 119.614 114.658 118.245V106.102H127.453C142.376 106.102 154.518 118.332 154.518 133.363L156.979 171.5H107.522L85.3776 175.495V133.363C85.3776 121.879 79.3641 111.807 70.361 106.102H109.737ZM69.9772 186.517C57.7902 197.258 45.5614 202.262 31.4921 202.262H21.4039C17.3785 202.262 14.9401 199.622 14.0027 197.151C13.0505 194.646 13.1169 190.993 16.1556 188.247L24.8044 180.452H76.5739L69.9772 186.517ZM48.9618 253.316C48.9618 241.975 58.1224 232.746 69.3842 232.746C73.3604 232.746 77.1472 233.938 80.4566 236.099V257.281H49.4466C49.1685 255.958 48.9618 254.612 48.9618 253.316ZM85.3776 257.281V180.452H102.601V257.281H85.3776Z'
								fill='#151515'
							/>
						</svg>

						<h2 className='font-semibold text-base text-red-600 mt-3'>Please verify email.</h2>
						<p>We send verify url to your email.</p>
						<p className='text-xs'>If you verified your email. Please to go login.</p>
						<div className='flex gap-2'>
							<Button className='mt-3' onClick={onClose}>
								Close
							</Button>
							<Button type='primary' className='mt-3' href='/login'>
								Go to login
							</Button>
						</div>
					</div>
				</Card>
			)}
			{verify === "completed" && <VerifyActived />}
		</div>
	);
};

export default VerifyAccount;
